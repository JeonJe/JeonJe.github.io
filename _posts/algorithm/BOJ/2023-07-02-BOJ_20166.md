---
title: BeakJoon  20166. ë¬¸ìì—´ ì§€ì˜¥ì— ë¹ ì§„ í˜¸ì„
categories: algorithm beakjoon
tags: [beakjoon, dfs]
---

>  Kë²ˆ ì¤‘ë³µëœ ê³„ì‚°ì„ 1ë²ˆìœ¼ë¡œ ì¤„ì´ê³ , ê° ë¬¸ìì—´ì„ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ mapì— ì €ì¥



ë¬¸ì œ URL: https://www.acmicpc.net/problem/20166



# ğŸ˜’ë¬¸ì œ

---

*í•˜ë£¨ ì¢…ì¼ ë‚´ë¦¬ëŠ” ë¹„ì— ì„¸ìƒì´ ì¶œë ì´ê³  êµ¬ë¦„ì´ í•´ë¥¼ ë¨¹ì–´ ë°¤ì¸ì§€ ë‚®ì¸ì§€ ëª¨ë¥´ëŠ” ì–´ëŠ ì—¬ë¦„ ë‚ *

ì  ë“¤ê¸° ì‹«ì–´ ë²„í‹°ë˜ í˜¸ì„ì´ëŠ” ë¬´ê±°ìš´ ëˆˆêº¼í’€ì— íŒ¨ë°°í–ˆë‹¤. ì •ì‹ ì„ ì°¨ë ¤ë³´ë‹ˆ ë°”ë‹¥ì—ëŠ” ê²©ì ëª¨ì–‘ì˜ íƒ€ì¼ì´ ê°€ë“í•œ ì„¸ìƒì´ì—ˆê³ , ê° íƒ€ì¼ë§ˆë‹¤ ì•ŒíŒŒë²³ ì†Œë¬¸ìê°€ í•˜ë‚˜ì”© ì¨ìˆë‹¤ë”ë¼. ë‘ë ¤ì›€ì— ê°€ë“í•´ ë¯¸ì¹œë“¯ì´ ì•ë§Œ ë³´ê³  ë‹¬ë ¤ ëì„ ì°¾ì•„ í—¤ë§¸ì§€ë§Œ ì´ ì„¸ìƒì€ ëì´ ì—†ì—ˆê³ , ë‹¬ë¦¬ë‹¤ ì§€ì³ ë°”ë‹¥ì— ë“œëŸ¬ëˆ„ìš°ë‹ˆ í•˜ëŠ˜ì— ì´ëŸ° ë¬¸êµ¬ê°€ í•ë¹› êµ¬ë¦„ìœ¼ë¡œ ë– ë‹¤ë‹ˆê³  ìˆì—ˆë‹¤.

- ì´ ì„¸ìƒì€Â *N*í–‰Â *M*ì—´ì˜ ê²©ìë¡œ ìƒê²¼ìœ¼ë©°,Â ê° ì¹¸ì—Â ì•ŒíŒŒë²³ì´ ì¨ìˆê³  í™˜í˜•ìœ¼ë¡œ ì´ì–´ì§„ë‹¤. ì™¼ìª½ ìœ„ë¥¼ (1, 1), ì˜¤ë¥¸ìª½ ì•„ë˜ë¥¼ (*N*,Â *M*)ì´ë¼ê³  í•˜ì.
- ë„ˆëŠ” ì•„ë¬´ ê³³ì—ì„œë‚˜ ì‹œì‘í•´ì„œ ìƒí•˜ì¢Œìš°ë‚˜ ëŒ€ê°ì„  ë°©í–¥ì˜ ì¹¸ìœ¼ë¡œ í•œ ì¹¸ì”© ì´ë™í•  ìˆ˜ ìˆë‹¤. ì´ ë•Œ, ì´ë¯¸ ì§€ë‚˜ ì™”ë˜ ì¹¸ë“¤ì„ ë‹¤ì‹œ ë°©ë¬¸í•˜ëŠ” ê²ƒì€ í—ˆìš©í•œë‹¤.
- ì‹œì‘í•˜ëŠ” ê²©ìì˜ ì•ŒíŒŒë²³ì„Â ì‹œì‘ìœ¼ë¡œ, ì´ë™í•  ë•Œë§ˆë‹¤ ê° ì¹¸ì— ì¨ì§„ ì•ŒíŒŒë²³ì„ ì´ì–´ ë¶™ì—¬ì„œÂ ë¬¸ìì—´ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
- ì´ ê³³ì˜ ì‹ ì¸ ë‚´ê°€ ì¢‹ì•„í•˜ëŠ” ë¬¸ìì—´ì„Â *K*Â ê°œ ì•Œë ¤ì¤„ í„°ì´ë‹ˆ, ê° ë¬¸ìì—´ ë§ˆë‹¤ ë„ˆê°€ ë§Œë“¤ ìˆ˜ ìˆëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ ì˜ ëŒ€ë‹µí•´ì•¼ ë„ˆì˜ ì„¸ê³„ë¡œ ëŒì•„ê°ˆ ê²ƒì´ë‹¤.
- ê²½ìš°ì˜ ìˆ˜ë¥¼ ì…€ ë•Œ, ë°©ë¬¸ ìˆœì„œê°€ ë‹¤ë¥´ë©´ ë‹¤ë¥¸ ê²½ìš°ì´ë‹¤. ì¦‰, (1,1)->(1,2) ë¡œ ê°€ëŠ” ê²ƒê³¼ (1,2)->(1,1) ì„ ê°€ëŠ” ê²ƒì€ ì„œë¡œ ë‹¤ë¥¸ ê²½ìš°ì´ë‹¤.

í˜¸ì„ì´ëŠ” í•˜ëŠ˜ì„ ë³´ê³ ì„œÂ *"í™˜í˜•ì´ ë¬´ì—‡ì¸ì§€ëŠ” ì•Œë ¤ë‹¬ë¼!"*Â ë©° ì†Œë¦¬ë¥¼ ì§€ë¥´ë‹ˆ í•ë¹› êµ¬ë¦„ì´ í©ì–´ì¡Œë‹¤ê°€ ëª¨ì´ë©° ì•„ë˜ì™€ ê°™ì€ ë§ì„ ê·¸ë ¸ë‹¤.

- ë„ˆê°€ 1í–‰ì—ì„œ ìœ„ë¡œ ê°€ë©´Â *N*Â í–‰ìœ¼ë¡œ ê°€ê²Œ ë˜ë©° ë°˜ëŒ€ë„ ê°€ëŠ¥í•˜ë‹¤.
- ë„ˆê°€ 1ì—´ì—ì„œ ì™¼ìª½ìœ¼ë¡œ ê°€ë©´Â *M*Â ì—´ë¡œ ê°€ê²Œ ë˜ë©° ë°˜ëŒ€ë„ ê°€ëŠ¥í•˜ë‹¤.
- ëŒ€ê°ì„  ë°©í–¥ì— ëŒ€í•´ì„œë„ ë™ì¼í•œ ê·œì¹™ì´ ì ìš©ëœë‹¤.
- í•˜ëŠ˜ì— ì•„ë˜ì™€ ê°™ì€ ê·¸ë¦¼ì„ êµ¬ë¦„ìœ¼ë¡œ ê·¸ë ¤ì¤„ í„°ì´ë‹ˆ ì´í•´í•´ ë•ë„ë¡ í•˜ì—¬ë¼.
- ì˜ˆë¥¼ ë“¤ì–´ì„œ, ë„ˆê°€ (1, 1)ì—ì„œ ìœ„ë¡œ ê°€ë©´ (*N*, 1)ì´ê³ , ì™¼ìª½ìœ¼ë¡œ ê°€ë©´ (1,Â *M*)ì´ë©° ì™¼ìª½ ìœ„ ëŒ€ê°ì„  ë°©í–¥ìœ¼ë¡œ ê°€ë©´ (*N*,Â *M*)ì¸ ê²ƒì´ë‹¤.


ì„¸ìƒì„ ì´ë£¨ëŠ” ê²©ìì˜ ì •ë³´ì™€,Â *K*Â ê°œì˜ ë¬¸ìì—´ì´ ì£¼ì–´ì¡Œì„ ë•Œ, í˜¸ì„ì´ê°€ ëŒ€ë‹µí•´ì•¼ í•˜ëŠ” ì •ë‹µì„ êµ¬í•´ì£¼ë„ë¡ í•˜ì.

# ğŸ‘€ì œì•½ì¡°ê±´

---

## ì…ë ¥

ì²«ë²ˆì§¸ ì¤„ì— ê²©ìì˜ í¬ê¸°Â *N*,Â *M*ê³¼ ì‹ ì´ ì¢‹ì•„í•˜ëŠ” ë¬¸ìì—´ì˜ ê°œìˆ˜Â *K*Â ê°€ ì£¼ì–´ì§„ë‹¤.

ë‹¤ìŒì—Â *N*ê°œì˜ ì¤„ì— ê±¸ì³ì„œ Mê°œì˜ ì•ŒíŒŒë²³ ì†Œë¬¸ìê°€ ê³µë°±ì—†ì´ ì£¼ì–´ì§„ë‹¤. ì—¬ê¸°ì„œì˜ ì²« ë²ˆì§¸ ì¤„ì€ 1í–‰ì˜ ì •ë³´ì´ë©°,Â *N*Â ë²ˆì§¸ ì¤„ì€Â *N*í–‰ì˜ ì •ë³´ì´ë‹¤.

ì´ì–´ì„œÂ *K*ê°œì˜ ì¤„ì— ê±¸ì³ì„œ ì‹ ì´ ì¢‹ì•„í•˜ëŠ” ë¬¸ìì—´ì´ ì£¼ì–´ì§„ë‹¤. ëª¨ë‘ ì•ŒíŒŒë²³ ì†Œë¬¸ìë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.

## ì¶œë ¥

*K*ê°œì˜ ì¤„ì— ê±¸ì³ì„œ, ì‹ ì´ ì¢‹ì•„í•˜ëŠ” ë¬¸ìì—´ì„ ë§Œë“¤ ìˆ˜ ìˆëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ ìˆœì„œëŒ€ë¡œ ì¶œë ¥í•œë‹¤.

## ì œí•œ

- 3 â‰¤Â *N*,Â *M*Â â‰¤Â 10,Â *N*ê³¼Â *M*ì€ ìì—°ìˆ˜ì´ë‹¤.
- 1 â‰¤Â *K*Â â‰¤Â 1,000,Â *K*ëŠ” ìì—°ìˆ˜ì´ë‹¤.
- 1 â‰¤Â ì‹ ì´ ì¢‹ì•„í•˜ëŠ” ë¬¸ìì—´ì˜ ê¸¸ì´ â‰¤ 5
- ì‹ ì´ ì¢‹ì•„í•˜ëŠ” ë¬¸ìì—´ì€Â ì¤‘ë³µë  ìˆ˜ë„ ìˆë‹¤.

### ì˜ˆì œ ì…ë ¥ 1

```
3 3 2
aaa
aba
aaa
aa
bb

```

### ì˜ˆì œ ì¶œë ¥ 1

```
56
0

```

### ì˜ˆì œ ì…ë ¥ 2

```
3 4 3
abcb
bcaa
abac
aba
abc
cab

```

### ì˜ˆì œ ì¶œë ¥ 2

```
66
32
38
```

## ğŸ¤©ì ‘ê·¼ë°©ë²•

---

dfsë¬¸ì œ ìœ í˜•ì…ë‹ˆë‹¤.

ì²˜ìŒì—ëŠ” `Kë²ˆ ë¬¸ìì—´ì— ëŒ€í•´ 1,1ë¶€í„° N,Mê¹Œì§€ ê° ì¢Œí‘œë¥¼ ì´ë™í•˜ë©´ì„œ Kë²ˆ ë¬¸ìì—´ì„ ëª‡ê°œ ë§Œë“¤ ìˆ˜ ìˆëŠ”ì§€?` ë¥¼ í™•ì¸í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì ‘ê·¼í•˜ì˜€ìŠµë‹ˆë‹¤. 

í•˜ì§€ë§Œ ë¬¸ì œ ì…ë ¥ë²”ìœ„ê°€ KëŠ” ìµœëŒ€ `1000`, ë³´ë“œëŠ” ìµœëŒ€ `10x10`ì´ë©°, `8`ë°©í–¥(ìƒí•˜ì¢Œìš° ëŒ€ê°ì„ )ì— ëŒ€í•´ ë¬¸ìì—´ì˜ ìµœëŒ€ ê¸¸ì´ê°€ `5`ê°œì´ê¸° ë•Œë¬¸ì— **1000 x 10 x 10 x 8^5** = `3,276,800,000` ì˜ ê³„ì‚°ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•œ ê²½ìš° pythonìœ¼ë¡œ ì œì¶œ ì‹œ 53%ì—ì„œ ì‹œê°„ì´ˆê³¼ê°€ ë°œìƒí•©ë‹ˆë‹¤.

ìœ„ ì ‘ê·¼ ë°©ì‹ì—ì„œ ê°œì„ í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì€ `Kë²ˆ ë°˜ë³µí•˜ëŠ” ë¶€ë¶„ â†’ 1íšŒë¡œ ì¤„ì—¬ ì¤‘ë³µ ê³„ì‚°`ì„ í•˜ì§€ ì•ŠëŠ” ê²ƒì…ë‹ˆë‹¤.

ìƒê°í•´ë³´ë©´ Kì™€ ê´€ê³„ì—†ì´ ë³´ë“œì—ì„œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ë¬¸ìì—´ì˜ ìˆ˜ëŠ” ìµœëŒ€ **10 x 10 x 8^5** = `3276800` ì…ë‹ˆë‹¤. 

ì¦‰, ìµœëŒ€ `327600` ë²ˆìœ¼ë¡œ ë¬¸ìì—´ì´ ëª¨ë“  ì¢Œí‘œì—ì„œ ê° ë¬¸ìì—´ì´ ëª‡ë²ˆ ë‚˜ì˜¤ëŠ”ì§€ map(keyëŠ” ë¬¸ìì—´, valueëŠ” íšŸìˆ˜)ì— ë‹´ì•„ë‘˜ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤. 

ì´í›„ ë°˜ë³µë¬¸ Kë²ˆì„ ë”°ë¡œ ëŒë©´ì„œ Mapì— ë‹´ê¸´ ë¬¸ìì—´ì„ ë§Œë“¤ ìˆ˜ ìˆëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ O(1)ë¡œ í™•ì¸í•˜ëŠ” ê²ƒì´ ë¬¸ì œì˜ í•µì‹¬ì´ì˜€ìŠµë‹ˆë‹¤.

## ğŸ¤”í’€ì´

---

```python
import sys
from collections import defaultdict 
input = sys.stdin.readline
sys.setrecursionlimit(10**9)

N, M, K = map(int,input().split())
board = [list(input().rstrip()) for _ in range(N)]
str_map = defaultdict(int)

dx = [1,1,0,-1,-1,-1,0,1]
dy = [0,-1,-1,-1,0,1,1,1]

def dfs(x,y,depth,path):
    if depth == 5:
        return 
  
    str_map[path] += 1
        
    for i in range(8):
        nx = (x + dx[i] + N) % N 
        ny = (y + dy[i] + M) % M    
        dfs(nx, ny, depth+1, path + board[nx][ny])

for i in range(N):
  for j in range(M):
    dfs(i,j,0,board[i][j])

for i in range(K):
    target = input().rstrip()
    print(str_map[target])
```

## ğŸ§

---

**ì²˜ìŒ ì ‘ê·¼í•œ DFS ì½”ë“œ  python 53% ì‹œê°„ì´ˆê³¼**

```python
import sys
input = sys.stdin.readline
sys.setrecursionlimit(10**9)

from collections import defaultdict 

N, M, K = map(int,input().split())

board = [list(input()) for _ in range(N)]

dx = [1,1,0,-1,-1,-1,0,1]
dy = [0,-1,-1,-1,0,1,1,1]

def solution():
    #targetì„ ë§Œë“¤ ìˆ˜ ìˆëŠ” ê²½ìš°ì˜ ìˆ˜ë¥¼ ë¦¬í„´
    for i in range(N):
        for j in range(M):
            #i,jì—ì„œ ì‹œì‘ 
            dfs(i,j,1,[board[i][j]])

    global cnt 
    return cnt

def dfs(x,y,depth,path):
    if depth >= 5:
        return 

    global target
    if len(path) >= len(target):
        
        if target == "".join(path):
            global cnt
            cnt += 1
        return 
         
    for i in range(8):
        nx = x + dx[i]
        ny = y + dy[i]

        if nx < 0:
            nx = N-1
        elif nx >= N:
            nx = 0
        if ny < 0:
            ny = M-1
        elif ny >= M:
            ny = 0
        
        prev = "".join(path)
        check = prev + board[nx][ny]

        if check == target[:depth+1]:
          path.append(board[nx][ny])
          dfs(nx,ny,depth+1,path)
          path.pop()
    

for i in range(K):
    target = input()
    cnt = 0
    print(solution())
```


1. ì†ë„ë¥¼ ì¦ê°€ì‹œí‚¤ë ¤ê³  input = sys.stdin.readlineì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ì´ ë°©ì‹ìœ¼ë¡œ ì½ì–´ë“¤ì¼ ê²½ìš° `â€˜\nâ€™` ë„ í¬í•¨ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— `rstrip()` ì„ í•¨ê»˜ ì‚¬ìš©í•´ì¤˜ì•¼í•©ë‹ˆë‹¤.
2. í™˜í˜•ìœ¼ë¡œ ì´ë™í•˜ëŠ” ë¶€ë¶„ì— ëŒ€í•œ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ì´ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì²˜ìŒì—” ì•„ë˜ì™€ ê°™ì´ ifë¬¸ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ëŠ”ë°, ì´ ì½”ë“œëŠ” `%` ì—°ì‚°ì„ í™œìš©í•˜ì—¬ 2ì¤„ë¡œ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

```python
	   if nx < 0:
            nx = N-1
        elif nx >= N:
            nx = 0
        if ny < 0:
            ny = M-1
        elif ny >= M:
            ny = 0
#+Nì„ ë”í•´ì¤˜ì„œ -1ì„ ì ˆëŒ€ ë§Œë“¤ì§€ ì•Šì„ ìˆ˜ë„ ìˆê³ , +Nì„ ìƒëµí•˜ë”ë¼ë„ -1%(N)ì„í•˜ë©´ 
#ì›í•˜ëŠ” N-1ë¡œ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    nx = (x + dx[i]+N ) % N 
    ny = (y + dy[i] ) % M    
```